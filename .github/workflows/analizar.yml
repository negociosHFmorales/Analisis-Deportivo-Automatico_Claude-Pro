name: Analizar Partidos Deportivos

# Este workflow se ejecuta cuando se crea un nuevo issue
on:
  issues:
    types: [opened]

jobs:
  analizar:
    # Solo ejecutar si el issue tiene "An√°lisis de partidos" en el t√≠tulo
    if: contains(github.event.issue.title, 'An√°lisis de partidos')
    
    runs-on: ubuntu-latest
    
    steps:
      # Paso 1: Descargar el c√≥digo del repositorio
      - name: Descargar c√≥digo
        uses: actions/checkout@v3
      
      # Paso 2: Instalar Python
      - name: Configurar Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'
      
      # Paso 3: Instalar las librer√≠as necesarias
      - name: Instalar dependencias
        run: |
          pip install pandas numpy scipy requests
          pip install python-dateutil
      
      # Paso 4: Ejecutar el an√°lisis
      - name: Ejecutar an√°lisis de partidos
        run: |
          echo "Iniciando an√°lisis de partidos..."
          echo "Datos del issue: ${{ github.event.issue.body }}"
          python analizar_partidos.py "${{ github.event.issue.body }}"
      
      # Paso 5: Comentar los resultados en el issue
      - name: Publicar resultados
        uses: actions/github-script@v6
        with:
          script: |
            const fs = require('fs');
            let resultado = 'No se encontraron resultados';
            
            // Leer el archivo de resultados si existe
            if (fs.existsSync('resultados.txt')) {
              resultado = fs.readFileSync('resultados.txt', 'utf8');
            }
            
            // Crear un comentario en el issue con los resultados
            github.rest.issues.createComment({
              issue_number: context.issue.number,
              owner: context.repo.owner,
              repo: context.repo.repo,
              body: `## üìä Resultados del An√°lisis\n\n${resultado}\n\n‚úÖ An√°lisis completado a las ${new Date().toLocaleString('es-CO', {timeZone: 'America/Bogota'})}`
            });
